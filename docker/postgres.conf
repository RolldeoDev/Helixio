#------------------------------------------------------------------------------
# HELIXIO EMBEDDED POSTGRESQL CONFIGURATION
#------------------------------------------------------------------------------
# Optimized for embedded use in a Docker container with a single application.
# This configuration prioritizes:
# - Low memory footprint
# - Fast startup
# - Data safety (fsync enabled)
# - No network exposure (localhost only)
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

# Listen only on localhost - no external network access
listen_addresses = 'localhost'
port = 5432

# Connection limits (conservative for embedded use)
max_connections = 20

# Unix socket for local connections
unix_socket_directories = '/var/run/postgresql'

#------------------------------------------------------------------------------
# MEMORY
#------------------------------------------------------------------------------

# Shared memory for data caching (128MB reasonable for container)
shared_buffers = 128MB

# Per-query memory
work_mem = 4MB

# Memory for maintenance operations (VACUUM, CREATE INDEX, etc.)
maintenance_work_mem = 64MB

# Temp file limit (prevent runaway queries)
temp_file_limit = 256MB

#------------------------------------------------------------------------------
# WRITE-AHEAD LOG (WAL)
#------------------------------------------------------------------------------

# Minimal WAL for standalone use (no replication)
wal_level = minimal
max_wal_senders = 0

# WAL size (smaller for embedded use)
min_wal_size = 32MB
max_wal_size = 256MB

# Checkpoint settings
checkpoint_completion_target = 0.9
checkpoint_timeout = 5min

#------------------------------------------------------------------------------
# DATA SAFETY
#------------------------------------------------------------------------------

# Always fsync for data safety
fsync = on
synchronous_commit = on
full_page_writes = on

#------------------------------------------------------------------------------
# QUERY PLANNING
#------------------------------------------------------------------------------

# Random page cost (lower for SSD, which is typical in containers)
random_page_cost = 1.1

# Effective cache size (help planner understand available memory)
effective_cache_size = 256MB

#------------------------------------------------------------------------------
# LOGGING
#------------------------------------------------------------------------------

# Log to stderr (container best practice)
log_destination = 'stderr'
logging_collector = off

# Log slow queries (useful for debugging)
log_min_duration_statement = 1000

# Log connection attempts (security)
log_connections = on
log_disconnections = on

# Log timezone
log_timezone = 'UTC'

#------------------------------------------------------------------------------
# LOCALE AND ENCODING
#------------------------------------------------------------------------------

# Use UTC for consistency
timezone = 'UTC'

# Default encoding
client_encoding = 'UTF8'

#------------------------------------------------------------------------------
# AUTOVACUUM
#------------------------------------------------------------------------------

# Enable autovacuum (important for MVCC cleanup)
autovacuum = on
autovacuum_max_workers = 2
autovacuum_naptime = 1min

#------------------------------------------------------------------------------
# STATISTICS
#------------------------------------------------------------------------------

# Track statistics for query optimization
track_activities = on
track_counts = on
