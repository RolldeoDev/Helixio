/**
 * Retro Gaming Theme Effects - "Pixel Quest"
 *
 * "THE CAKE IS A LIE"
 *
 * Authentic 8-bit/16-bit gaming aesthetics with:
 * - Pixel grid overlay for that CRT feel
 * - Scanlines and screen curvature
 * - Floating game items (coins, stars, hearts)
 * - Classic hard-edge pixel shadows
 * - Score counter and lives display
 *
 * Every pixel is intentional. No anti-aliasing allowed.
 */

/* =============================================================================
   Retro Gaming Color Variables
   ============================================================================= */

:root[data-theme^="retro"] {
  /* NES-inspired primary palette */
  --retro-red: #e63946;
  --retro-red-dark: #be1c31;
  --retro-red-light: #ff4d5a;

  --retro-blue: #29adff;
  --retro-blue-dark: #1d7db8;
  --retro-blue-light: #5cc5ff;

  --retro-yellow: #ffcc00;
  --retro-yellow-dark: #d4a800;
  --retro-yellow-light: #ffe44d;

  --retro-green: #00e436;
  --retro-green-dark: #00b328;
  --retro-green-light: #44ff6f;

  /* Background palette */
  --retro-bg-dark: #1a1c2c;
  --retro-bg-mid: #232538;
  --retro-bg-light: #2a2d42;

  /* Text */
  --retro-white: #f0f0f0;
  --retro-gray: #8b8b9a;

  /* Special */
  --retro-gold: #ffcc00;
  --retro-coin-shine: #fff8dc;

  /* Pixel sizes */
  --pixel-size: 4px;
  --pixel-size-sm: 2px;
}

/* =============================================================================
   Pixel Grid Overlay - CRT Pixel Pattern
   ============================================================================= */

.retro-pixel-grid {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0; /* Subtle overlay behind content */
  background-image:
    linear-gradient(rgba(0, 0, 0, 0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
  background-size: var(--pixel-size) var(--pixel-size);
  opacity: 0.5;
}

/* =============================================================================
   CRT Screen Effects
   ============================================================================= */

.retro-crt-overlay {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0; /* Subtle overlay behind content */
  overflow: hidden;
}

/* Horizontal scanlines */
.retro-crt-scanlines {
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent 0px,
    transparent 2px,
    rgba(0, 0, 0, 0.04) 2px,
    rgba(0, 0, 0, 0.04) 4px
  );
  animation: scanlineScroll 10s linear infinite;
}

@keyframes scanlineScroll {
  from { background-position: 0 0; }
  to { background-position: 0 100px; }
}

/* Screen curvature vignette */
.retro-crt-curve {
  position: absolute;
  inset: 0;
  background: radial-gradient(
    ellipse 120% 120% at 50% 50%,
    transparent 0%,
    transparent 50%,
    rgba(0, 0, 0, 0.15) 80%,
    rgba(0, 0, 0, 0.4) 100%
  );
  border-radius: 20px;
}

/* =============================================================================
   Floating Pixel Items - Coins, Stars, Hearts, Gems
   ============================================================================= */

.retro-pixels {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -1; /* Behind all content - floating elements should be unobtrusive */
  overflow: hidden;
}

.retro-pixel {
  position: absolute;
  bottom: -20px;
  width: 16px;
  height: 16px;
  image-rendering: pixelated;
  animation: pixelFloat 15s linear infinite;
  opacity: 0;
}

/* Coin - Gold spinning pixel */
.retro-pixel--coin {
  background: var(--retro-gold);
  box-shadow:
    inset -4px -4px 0 var(--retro-yellow-dark),
    inset 4px 4px 0 var(--retro-coin-shine);
  border-radius: 50%;
  animation-name: pixelFloat, coinSpin;
}

/* Star - Yellow star shape using clip-path */
.retro-pixel--star {
  background: var(--retro-yellow);
  clip-path: polygon(
    50% 0%,
    61% 35%,
    98% 35%,
    68% 57%,
    79% 91%,
    50% 70%,
    21% 91%,
    32% 57%,
    2% 35%,
    39% 35%
  );
  animation-name: pixelFloat, starTwinkle;
}

/* Heart - Red heart using clip-path */
.retro-pixel--heart {
  background: var(--retro-red);
  clip-path: polygon(
    50% 100%,
    0% 35%,
    25% 10%,
    50% 25%,
    75% 10%,
    100% 35%
  );
  box-shadow: inset -3px -3px 0 var(--retro-red-dark);
}

/* Gem - Blue diamond */
.retro-pixel--gem {
  background: linear-gradient(135deg, var(--retro-blue-light) 0%, var(--retro-blue) 50%, var(--retro-blue-dark) 100%);
  clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
  animation-name: pixelFloat, gemShine;
}

@keyframes pixelFloat {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 0;
  }
  5% {
    opacity: 0.9;
  }
  50% {
    transform: translateY(-50vh) rotate(180deg);
  }
  95% {
    opacity: 0.7;
  }
  100% {
    transform: translateY(-110vh) rotate(360deg);
    opacity: 0;
  }
}

@keyframes coinSpin {
  0%, 100% { transform: translateY(0) scaleX(1); }
  25% { transform: translateY(-25vh) scaleX(0.3); }
  50% { transform: translateY(-50vh) scaleX(1); }
  75% { transform: translateY(-75vh) scaleX(0.3); }
}

@keyframes starTwinkle {
  0%, 100% { filter: brightness(1); }
  50% { filter: brightness(1.5); }
}

@keyframes gemShine {
  0%, 100% { filter: brightness(1) saturate(1); }
  50% { filter: brightness(1.3) saturate(1.2); }
}

/* =============================================================================
   Game Quote Display
   ============================================================================= */

.retro-quote {
  position: fixed;
  bottom: 60px;
  left: 50%;
  transform: translateX(-50%);
  pointer-events: none;
  z-index: 1;
  font-family: 'Press Start 2P', monospace;
  font-size: 10px;
  letter-spacing: 1px;
  color: var(--retro-yellow);
  text-shadow:
    2px 2px 0 var(--retro-yellow-dark),
    -1px -1px 0 rgba(0, 0, 0, 0.5);
  opacity: 0;
  transition: opacity 0.5s ease;
  white-space: nowrap;
  padding: 8px 16px;
  background: rgba(0, 0, 0, 0.6);
  border: 2px solid var(--retro-yellow);
  image-rendering: pixelated;
}

.retro-quote.visible {
  opacity: 1;
}

.retro-quote-cursor {
  display: inline-block;
  animation: cursorBlink 0.5s step-end infinite;
  margin-left: 2px;
}

@keyframes cursorBlink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

/* =============================================================================
   Score Display - Top Left Corner
   ============================================================================= */

.retro-score-display {
  position: fixed;
  bottom: 80px;
  left: 100px; /* Account for sidebar width */
  pointer-events: none;
  z-index: 1;
  font-family: 'Press Start 2P', monospace;
  font-size: 8px;
  color: var(--retro-white);
  text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.5);
  opacity: 0.6;
}

.retro-score-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.retro-score-label {
  color: var(--retro-gray);
}

.retro-score-value {
  color: var(--retro-white);
  font-variant-numeric: tabular-nums;
}

.retro-coin-icon {
  display: inline-block;
  width: 10px;
  height: 10px;
  background: var(--retro-gold);
  border-radius: 50%;
  box-shadow:
    inset -2px -2px 0 var(--retro-yellow-dark),
    inset 2px 2px 0 var(--retro-coin-shine);
  animation: coinPulse 1s ease-in-out infinite;
}

@keyframes coinPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

/* =============================================================================
   Lives Display - Top Right Corner
   ============================================================================= */

.retro-lives-display {
  position: fixed;
  bottom: 80px;
  right: 20px;
  pointer-events: none;
  z-index: 1;
  display: flex;
  gap: 6px;
  opacity: 0.6;
}

.retro-heart {
  display: inline-block;
  width: 12px;
  height: 12px;
  background: var(--retro-red);
  clip-path: polygon(
    50% 100%,
    0% 35%,
    25% 0%,
    50% 20%,
    75% 0%,
    100% 35%
  );
  box-shadow: inset -2px -2px 0 var(--retro-red-dark);
  animation: heartBeat 2s ease-in-out infinite;
}

.retro-heart:nth-child(2) {
  animation-delay: 0.3s;
}

.retro-heart:nth-child(3) {
  animation-delay: 0.6s;
}

@keyframes heartBeat {
  0%, 100% { transform: scale(1); }
  15% { transform: scale(1.15); }
  30% { transform: scale(1); }
}

/* =============================================================================
   Component-Specific Overrides for Retro Theme
   ============================================================================= */

/* Cards get pixel-art shadows */
:root[data-theme="retro-dark"] .cover-card,
:root[data-theme="retro-dark"] .series-cover-card {
  background: var(--retro-bg-mid);
  border: 3px solid var(--retro-bg-light);
  border-radius: 0;
  box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.4);
  transition: all 0.15s ease;
  image-rendering: auto;
}

:root[data-theme="retro-dark"] .cover-card:hover,
:root[data-theme="retro-dark"] .series-cover-card:hover {
  border-color: var(--retro-yellow);
  box-shadow:
    8px 8px 0 rgba(0, 0, 0, 0.5),
    0 0 0 2px var(--retro-yellow);
  transform: translate(-2px, -2px);
}

/* Sidebar */
:root[data-theme="retro-dark"] .sidebar-new {
  background: var(--retro-bg-dark);
  border-right: 3px solid var(--retro-bg-light);
}

:root[data-theme="retro-dark"] .sidebar-new .rail-btn.active {
  color: var(--retro-yellow);
  background: rgba(255, 204, 0, 0.1);
}

/* Buttons with pixel style */
:root[data-theme="retro-dark"] button,
:root[data-theme="retro-dark"] .btn {
  border-radius: 0;
  border: 3px solid;
  border-color: var(--retro-bg-light) var(--retro-bg-dark) var(--retro-bg-dark) var(--retro-bg-light);
  box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.4);
  font-family: 'VT323', monospace;
  font-size: 1.1em;
  letter-spacing: 1px;
  transition: all 0.1s ease;
}

:root[data-theme="retro-dark"] button:hover,
:root[data-theme="retro-dark"] .btn:hover {
  transform: translate(-2px, -2px);
  box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.5);
}

:root[data-theme="retro-dark"] button:active,
:root[data-theme="retro-dark"] .btn:active {
  transform: translate(2px, 2px);
  box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
  border-color: var(--retro-bg-dark) var(--retro-bg-light) var(--retro-bg-light) var(--retro-bg-dark);
}

:root[data-theme="retro-dark"] button.primary,
:root[data-theme="retro-dark"] .btn-primary {
  background: var(--retro-red);
  color: var(--retro-white);
  border-color: var(--retro-red-light) var(--retro-red-dark) var(--retro-red-dark) var(--retro-red-light);
}

/* Progress bars - Segmented like health bar */
:root[data-theme^="retro"] .progress-bar,
:root[data-theme^="retro"] .reading-progress-fill {
  background: repeating-linear-gradient(
    90deg,
    var(--retro-green) 0px,
    var(--retro-green) 8px,
    var(--retro-green-dark) 8px,
    var(--retro-green-dark) 10px
  );
  border-radius: 0;
  box-shadow: inset -2px -2px 0 var(--retro-green-dark);
}

/* Inputs */
:root[data-theme="retro-dark"] input,
:root[data-theme="retro-dark"] textarea,
:root[data-theme="retro-dark"] select {
  border-radius: 0;
  border: 3px solid;
  border-color: var(--retro-bg-dark) var(--retro-bg-light) var(--retro-bg-light) var(--retro-bg-dark);
  background: var(--retro-bg-dark);
  font-family: 'VT323', monospace;
  font-size: 1.1em;
}

:root[data-theme="retro-dark"] input:focus,
:root[data-theme="retro-dark"] textarea:focus,
:root[data-theme="retro-dark"] select:focus {
  border-color: var(--retro-yellow);
  box-shadow: 0 0 0 2px var(--retro-yellow);
  outline: none;
}

/* Scrollbar - Chunky pixel style */
:root[data-theme="retro-dark"] ::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

:root[data-theme="retro-dark"] ::-webkit-scrollbar-track {
  background: var(--retro-bg-dark);
  border: 2px solid var(--retro-bg-light);
}

:root[data-theme="retro-dark"] ::-webkit-scrollbar-thumb {
  background: var(--retro-bg-light);
  border: 2px solid;
  border-color: var(--retro-gray) var(--retro-bg-dark) var(--retro-bg-dark) var(--retro-gray);
}

:root[data-theme="retro-dark"] ::-webkit-scrollbar-thumb:hover {
  background: var(--retro-yellow);
}

/* Selection */
:root[data-theme="retro-dark"] ::selection {
  background: var(--retro-yellow);
  color: var(--retro-bg-dark);
}

/* Links */
:root[data-theme^="retro"] a {
  color: var(--retro-blue);
  text-decoration: none;
}

:root[data-theme^="retro"] a:hover {
  color: var(--retro-blue-light);
  text-decoration: underline;
  text-decoration-style: wavy;
}

/* Typography - Pixel fonts */
:root[data-theme^="retro"] h1,
:root[data-theme^="retro"] h2,
:root[data-theme^="retro"] h3 {
  font-family: 'Press Start 2P', monospace;
  letter-spacing: 1px;
  text-transform: uppercase;
}

:root[data-theme^="retro"] h1 {
  text-shadow: 4px 4px 0 var(--retro-red-dark);
}

/* =============================================================================
   Game Boy Light Theme Adjustments
   ============================================================================= */

:root[data-theme="retro-light"] {
  --retro-bg-dark: #9bbc0f;
  --retro-bg-mid: #8bac0f;
  --retro-bg-light: #306850;
}

:root[data-theme="retro-light"] .retro-pixel-grid {
  background-image:
    linear-gradient(rgba(15, 56, 15, 0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(15, 56, 15, 0.05) 1px, transparent 1px);
}

:root[data-theme="retro-light"] .retro-crt-scanlines {
  background: repeating-linear-gradient(
    0deg,
    transparent 0px,
    transparent 2px,
    rgba(15, 56, 15, 0.03) 2px,
    rgba(15, 56, 15, 0.03) 4px
  );
}

:root[data-theme="retro-light"] .retro-quote {
  color: #0f380f;
  border-color: #0f380f;
  background: rgba(155, 188, 15, 0.9);
  text-shadow: 1px 1px 0 #306850;
}

:root[data-theme="retro-light"] .retro-score-display {
  color: #0f380f;
  text-shadow: 1px 1px 0 #306850;
}

:root[data-theme="retro-light"] .retro-heart {
  background: #0f380f;
}

/* =============================================================================
   Reduced Motion - Accessibility
   ============================================================================= */

@media (prefers-reduced-motion: reduce) {
  :root[data-theme^="retro"] * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  .retro-crt-scanlines,
  .retro-pixels {
    display: none;
  }

  .retro-quote {
    opacity: 0.8;
  }
}

/* =============================================================================
   Print Styles - Hide All Effects
   ============================================================================= */

@media print {
  .retro-pixel-grid,
  .retro-crt-overlay,
  .retro-pixels,
  .retro-quote,
  .retro-score-display,
  .retro-lives-display {
    display: none !important;
  }
}
