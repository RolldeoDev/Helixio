/**
 * Endless Night Theme Effects - CSS
 *
 * "Everybody has a secret world inside of them."
 * - Dream of the Endless
 *
 * Gothic supernatural elegance meets impossible architecture.
 * Intimate darkness punctuated by warm candlelight,
 * with glimpses of infinite starfields beyond.
 */

/* =============================================================================
   Google Fonts Import - Art Nouveau Typography
   ============================================================================= */

@import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap');

/* =============================================================================
   Endless Night Theme Variables
   ============================================================================= */

:root[data-theme^="sandman"] {
  /* Void blacks */
  --endless-void: #050507;
  --endless-deep: #0a0b0f;
  --endless-surface: #12141a;

  /* Moonlight palette */
  --endless-ivory: #e8e4df;
  --endless-stone: #9a958d;
  --endless-shadow: #6a665f;

  /* Candlelight amber */
  --endless-amber: #d4a574;
  --endless-amber-bright: #e0b88a;
  --endless-amber-glow: rgba(212, 165, 116, 0.3);

  /* Ocean teal */
  --endless-teal: #2d7d8a;
  --endless-teal-light: #5a9aaa;
  --endless-teal-glow: rgba(45, 125, 138, 0.3);

  /* Animation timing */
  --starfield-rotation-duration: 480s; /* 8 minutes for full rotation */
  --feather-fall-duration: 30s;
}

/* =============================================================================
   BACKGROUND - The Infinite Void
   ============================================================================= */

:root[data-theme="sandman-dark"] body {
  background: var(--endless-void);
}

:root[data-theme="sandman-dark"] body::before {
  content: '';
  position: fixed;
  inset: 0;
  z-index: 0;
  background:
    /* Subtle teal mist in distant corners */
    radial-gradient(ellipse 60% 40% at 5% 5%, rgba(45, 125, 138, 0.05) 0%, transparent 50%),
    radial-gradient(ellipse 50% 40% at 95% 90%, rgba(45, 125, 138, 0.04) 0%, transparent 40%),
    /* Warm amber glow hint near bottom */
    radial-gradient(ellipse 80% 30% at 50% 100%, rgba(212, 165, 116, 0.03) 0%, transparent 50%),
    /* Base void */
    var(--endless-void);
  pointer-events: none;
}

/* =============================================================================
   STARFIELD DRIFT - Rotating cosmic background
   ============================================================================= */

.endless-starfield {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
  overflow: hidden;
}

.endless-starfield-layer {
  position: absolute;
  inset: -20%; /* Extend beyond viewport for rotation */
  transform-origin: center center;
}

/* Distant layer - slowest rotation */
.endless-starfield-layer--distant {
  animation: starfieldRotate var(--starfield-rotation-duration) linear infinite;
}

/* Medium layer - slightly faster */
.endless-starfield-layer--medium {
  animation: starfieldRotate calc(var(--starfield-rotation-duration) * 0.85) linear infinite;
  animation-direction: reverse;
}

/* Close layer - fastest, with slight counter-rotation feel */
.endless-starfield-layer--close {
  animation: starfieldRotate calc(var(--starfield-rotation-duration) * 0.7) linear infinite;
}

@keyframes starfieldRotate {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

/* Individual stars */
.endless-star {
  position: absolute;
  border-radius: 50%;
  transform: translate(-50%, -50%);
}

.endless-star--glow {
  filter: blur(0.5px);
}

.endless-star--bright {
  animation: starTwinkle 4s ease-in-out infinite;
}

@keyframes starTwinkle {
  0%, 100% {
    opacity: inherit;
    transform: translate(-50%, -50%) scale(1);
  }
  50% {
    opacity: calc(var(--star-opacity, 1) * 0.6);
    transform: translate(-50%, -50%) scale(0.8);
  }
}

/* =============================================================================
   RAVEN FEATHERS - Sparse drifting particles
   ============================================================================= */

.endless-feathers {
  position: fixed;
  inset: 0;
  z-index: 2;
  pointer-events: none;
  overflow: hidden;
}

.endless-feather {
  position: absolute;
  top: -60px;
  opacity: 0;
  animation: featherFall var(--duration, 30s) linear infinite;
  animation-delay: var(--delay, 0s);
  filter: blur(0.3px);
}

.endless-feather--small {
  filter: blur(0.5px);
  opacity: 0.5;
}

.endless-feather--medium {
  filter: blur(0.2px);
}

.endless-feather--large {
  filter: none;
}

@keyframes featherFall {
  0% {
    transform: translateY(-10px) rotate(var(--rotation, 0deg)) translateX(0);
    opacity: 0;
  }
  3% {
    opacity: 0.7;
  }
  25% {
    transform: translateY(25vh) rotate(calc(var(--rotation, 0deg) + 15deg)) translateX(20px);
  }
  50% {
    transform: translateY(50vh) rotate(calc(var(--rotation, 0deg) - 10deg)) translateX(-15px);
  }
  75% {
    transform: translateY(75vh) rotate(calc(var(--rotation, 0deg) + 20deg)) translateX(25px);
  }
  95% {
    opacity: 0.5;
  }
  100% {
    transform: translateY(110vh) rotate(calc(var(--rotation, 0deg) + 30deg)) translateX(10px);
    opacity: 0;
  }
}

/* Feather SVG styling */
.endless-feather-svg {
  display: block;
}

/* =============================================================================
   CARD STYLES - Intimate darkness with warm hover glow
   ============================================================================= */

:root[data-theme="sandman-dark"] .cover-card,
:root[data-theme="sandman-dark"] .series-cover-card {
  background: var(--endless-deep);
  border: 1px solid rgba(212, 165, 116, 0.08);
  border-radius: 8px;
  position: relative;
  overflow: hidden;
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1),
              border-color 0.4s ease,
              box-shadow 0.4s ease;
}

/* Subtle inner shadow breathing */
:root[data-theme="sandman-dark"] .cover-card::before,
:root[data-theme="sandman-dark"] .series-cover-card::before {
  content: '';
  position: absolute;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.6);
  opacity: 0.4;
  animation: cardBreathe 20s ease-in-out infinite;
}

@keyframes cardBreathe {
  0%, 100% {
    box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.6);
    opacity: 0.4;
  }
  50% {
    box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.7);
    opacity: 0.5;
  }
}

/* Hover glow effect */
:root[data-theme="sandman-dark"] .cover-card::after,
:root[data-theme="sandman-dark"] .series-cover-card::after {
  content: '';
  position: absolute;
  inset: -20px;
  z-index: -1;
  border-radius: 12px;
  background: radial-gradient(
    ellipse at center,
    var(--endless-amber-glow) 0%,
    transparent 70%
  );
  opacity: 0;
  filter: blur(20px);
  transition: opacity 0.5s ease;
}

:root[data-theme="sandman-dark"] .cover-card:hover,
:root[data-theme="sandman-dark"] .series-cover-card:hover {
  transform: translateY(-6px) scale(1.01);
  border-color: rgba(212, 165, 116, 0.25);
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
}

:root[data-theme="sandman-dark"] .cover-card:hover::after,
:root[data-theme="sandman-dark"] .series-cover-card:hover::after {
  opacity: 1;
}

:root[data-theme="sandman-dark"] .cover-card:hover::before,
:root[data-theme="sandman-dark"] .series-cover-card:hover::before {
  animation-play-state: paused;
  opacity: 0.2;
}

/* =============================================================================
   SIDEBAR - The Threshold
   ============================================================================= */

:root[data-theme="sandman-dark"] .sidebar-new {
  background: var(--endless-void);
  border-right: 1px solid rgba(212, 165, 116, 0.06);
}

:root[data-theme="sandman-dark"] .sidebar-new .icon-rail {
  background: var(--endless-void);
  border-right: 1px solid rgba(45, 125, 138, 0.05);
}

/* Rail buttons */
:root[data-theme^="sandman"] .sidebar-new .rail-btn {
  position: relative;
  transition: all 0.3s ease;
  color: var(--endless-stone);
}

:root[data-theme^="sandman"] .sidebar-new .rail-btn:hover {
  color: var(--endless-ivory);
}

:root[data-theme^="sandman"] .sidebar-new .rail-btn.active {
  color: var(--endless-amber);
}

:root[data-theme^="sandman"] .sidebar-new .rail-btn.active::after {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 2px;
  height: 20px;
  background: var(--endless-amber);
  box-shadow: 0 0 10px var(--endless-amber-glow);
}

/* =============================================================================
   TOOLBAR / FILTER BAR
   ============================================================================= */

:root[data-theme="sandman-dark"] .library-toolbar,
:root[data-theme="sandman-dark"] .toolbar,
:root[data-theme="sandman-dark"] .filter-bar,
:root[data-theme="sandman-dark"] .series-toolbar {
  background: var(--endless-deep);
  border: none;
  border-bottom: 1px solid rgba(45, 125, 138, 0.1);
  position: relative;
}

/* Subtle teal accent line */
:root[data-theme="sandman-dark"] .library-toolbar::after,
:root[data-theme="sandman-dark"] .series-toolbar::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 15%;
  right: 15%;
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent 0%,
    var(--endless-teal) 50%,
    transparent 100%
  );
  opacity: 0.3;
}

/* =============================================================================
   TYPOGRAPHY
   ============================================================================= */

:root[data-theme^="sandman"] h1,
:root[data-theme^="sandman"] h2 {
  font-family: var(--font-display);
  color: var(--endless-ivory);
  letter-spacing: 0.03em;
}

:root[data-theme^="sandman"] h1 {
  text-shadow: 0 0 30px rgba(212, 165, 116, 0.2);
}

/* =============================================================================
   STATUS BAR
   ============================================================================= */

:root[data-theme="sandman-dark"] .status-bar {
  background: var(--endless-void);
  border-top: 1px solid rgba(45, 125, 138, 0.08);
}

/* =============================================================================
   INPUT FIELDS
   ============================================================================= */

:root[data-theme="sandman-dark"] input[type="text"],
:root[data-theme="sandman-dark"] input[type="search"],
:root[data-theme="sandman-dark"] input[type="email"],
:root[data-theme="sandman-dark"] input[type="password"],
:root[data-theme="sandman-dark"] textarea,
:root[data-theme="sandman-dark"] select {
  background: var(--endless-void);
  border: 1px solid rgba(212, 165, 116, 0.12);
  border-radius: 6px;
  color: var(--endless-ivory);
  transition: all 0.3s ease;
}

:root[data-theme="sandman-dark"] input:focus,
:root[data-theme="sandman-dark"] textarea:focus,
:root[data-theme="sandman-dark"] select:focus {
  border-color: var(--endless-teal);
  box-shadow: 0 0 20px rgba(45, 125, 138, 0.15);
  outline: none;
}

:root[data-theme="sandman-dark"] input::placeholder,
:root[data-theme="sandman-dark"] textarea::placeholder {
  color: var(--endless-stone);
  opacity: 0.6;
}

/* =============================================================================
   SCROLLBAR
   ============================================================================= */

:root[data-theme="sandman-dark"] ::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

:root[data-theme="sandman-dark"] ::-webkit-scrollbar-track {
  background: transparent;
}

:root[data-theme="sandman-dark"] ::-webkit-scrollbar-thumb {
  background: rgba(45, 125, 138, 0.3);
  border-radius: 3px;
}

:root[data-theme="sandman-dark"] ::-webkit-scrollbar-thumb:hover {
  background: var(--endless-amber);
  box-shadow: 0 0 10px var(--endless-amber-glow);
}

/* =============================================================================
   LINKS
   ============================================================================= */

:root[data-theme^="sandman"] a {
  color: var(--endless-amber);
  text-decoration: none;
  transition: all 0.3s ease;
}

:root[data-theme^="sandman"] a:hover {
  color: var(--endless-amber-bright);
  text-shadow: 0 0 8px var(--endless-amber-glow);
}

/* =============================================================================
   BUTTONS
   ============================================================================= */

:root[data-theme="sandman-dark"] button,
:root[data-theme="sandman-dark"] .btn {
  background: var(--endless-surface);
  border: 1px solid rgba(212, 165, 116, 0.12);
  color: var(--endless-ivory);
  transition: all 0.3s ease;
}

:root[data-theme="sandman-dark"] button:hover,
:root[data-theme="sandman-dark"] .btn:hover {
  border-color: var(--endless-teal);
  color: var(--endless-teal-light);
  box-shadow: 0 0 15px rgba(45, 125, 138, 0.15);
}

:root[data-theme="sandman-dark"] button:active,
:root[data-theme="sandman-dark"] .btn:active {
  transform: translateY(1px);
}

/* Primary buttons */
:root[data-theme="sandman-dark"] button.primary,
:root[data-theme="sandman-dark"] .btn-primary {
  background: var(--endless-amber);
  border-color: var(--endless-amber);
  color: var(--endless-void);
}

:root[data-theme="sandman-dark"] button.primary:hover,
:root[data-theme="sandman-dark"] .btn-primary:hover {
  background: var(--endless-amber-bright);
  box-shadow: 0 0 25px var(--endless-amber-glow);
}

/* =============================================================================
   MODALS
   ============================================================================= */

:root[data-theme="sandman-dark"] .modal-overlay {
  background: rgba(5, 5, 7, 0.92);
  backdrop-filter: blur(4px);
}

:root[data-theme="sandman-dark"] .modal-content {
  background: var(--endless-deep);
  border: 1px solid rgba(45, 125, 138, 0.1);
  box-shadow: 0 25px 80px rgba(0, 0, 0, 0.7);
}

/* =============================================================================
   DROPDOWNS
   ============================================================================= */

:root[data-theme="sandman-dark"] .dropdown-menu,
:root[data-theme="sandman-dark"] .flyout-panel {
  background: var(--endless-deep);
  border: 1px solid rgba(212, 165, 116, 0.08);
  box-shadow: 0 15px 50px rgba(0, 0, 0, 0.6);
}

/* =============================================================================
   PROGRESS BARS
   ============================================================================= */

:root[data-theme^="sandman"] .progress-bar,
:root[data-theme^="sandman"] .reading-progress-fill,
:root[data-theme^="sandman"] .flyout-reading-progress-fill {
  background: linear-gradient(
    90deg,
    var(--endless-teal) 0%,
    var(--endless-amber) 100%
  );
  box-shadow: 0 0 10px var(--endless-teal-glow);
}

/* =============================================================================
   SELECTION
   ============================================================================= */

:root[data-theme="sandman-dark"] ::selection {
  background: rgba(45, 125, 138, 0.4);
  color: var(--endless-ivory);
}

/* =============================================================================
   LOADING SPINNER
   ============================================================================= */

:root[data-theme^="sandman"] .spinner {
  border-color: rgba(45, 125, 138, 0.15);
  border-top-color: var(--endless-amber);
}

/* =============================================================================
   CUSTOM CURSOR - Elegant and subtle
   ============================================================================= */

:root[data-theme="sandman-dark"] {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath d='M4 4 L12 20 L14 14 L20 12 Z' fill='%23e8e4df' stroke='%23050507' stroke-width='1'/%3E%3C/svg%3E") 4 4, auto;
}

:root[data-theme="sandman-dark"] a,
:root[data-theme="sandman-dark"] button,
:root[data-theme="sandman-dark"] [role="button"],
:root[data-theme="sandman-dark"] .clickable {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath d='M6 4 L6 18 L9 15 L12 20 L15 18 L12 13 L17 13 Z' fill='%23d4a574' stroke='%23050507' stroke-width='1'/%3E%3C/svg%3E") 6 4, pointer;
}

/* =============================================================================
   LIGHT THEME ADJUSTMENTS
   ============================================================================= */

:root[data-theme="sandman-light"] {
  --endless-void: #faf7f2;
  --endless-deep: #f0ebe4;
  --endless-surface: #e8e3da;
  --endless-ivory: #1a1d20;
  --endless-stone: #4a5560;
  --endless-shadow: #7a8590;
}

:root[data-theme="sandman-light"] .cover-card,
:root[data-theme="sandman-light"] .series-cover-card {
  background: var(--endless-deep);
  border: 1px solid rgba(184, 133, 74, 0.1);
}

:root[data-theme="sandman-light"] .sidebar-new {
  background: var(--endless-void);
  border-right: 1px solid rgba(184, 133, 74, 0.08);
}

/* Light mode feathers are darker and more visible */
:root[data-theme="sandman-light"] .endless-feather-svg path {
  fill: #2a2d35;
  stroke: #1a1c22;
}

/* =============================================================================
   REDUCED MOTION
   ============================================================================= */

@media (prefers-reduced-motion: reduce) {
  :root[data-theme^="sandman"] * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  .endless-feathers,
  .endless-starfield {
    display: none;
  }
}

/* =============================================================================
   PRINT STYLES
   ============================================================================= */

@media print {
  :root[data-theme^="sandman"] body::before,
  .endless-feathers,
  .endless-starfield {
    display: none !important;
  }
}
